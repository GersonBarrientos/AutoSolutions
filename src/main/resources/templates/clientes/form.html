<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{_layout :: head(~{::title})}">
  <title th:text="${cliente.id != null} ? 'Editar cliente · AutoSolutions' : 'Nuevo cliente · AutoSolutions'">Cliente</title>
</head>

<body th:replace="~{_layout :: layout(~{::title}, ~{::section})}">
<section>

  <!-- Header mejorado -->
  <div class="form-header">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="form-title" th:text="${cliente.id != null} ? 'Editar Cliente' : 'Nuevo Cliente'">Cliente</h1>
        <p class="page-subtitle mt-1" th:text="${cliente.id != null} ? 'Actualiza la información del cliente' : 'Completa los datos del nuevo cliente'">
          Información del cliente
        </p>
      </div>
      <a class="btn btn-back" th:href="@{/clientes}">
        <i class="bi bi-arrow-left me-1"></i> Volver
      </a>
    </div>
  </div>

  <!-- Formulario mejorado -->
  <div class="form-card">
    <form th:action="@{/clientes}" th:object="${cliente}" method="post">
      
      <!-- Alert de errores globales -->
      <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger-minimal alert-dismissible fade show" role="alert">
        <div class="d-flex align-items-start">
          <i class="bi bi-exclamation-circle-fill me-2" style="font-size: 1.25rem;"></i>
          <div class="flex-grow-1">
            <strong class="d-block mb-1">Error al guardar</strong>
            <p th:each="err : ${#fields.globalErrors()}" th:text="${err}" class="mb-0 small">Error</p>
          </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>

      <!-- Hidden fields -->
      <input type="hidden" th:if="*{id != null}" th:field="*{id}">
      <input type="hidden" th:if="*{id != null}" th:field="*{version}"> 
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

      <!-- Sección: Información Personal -->
      <div class="mb-4 pb-3" style="border-bottom: 1px solid var(--border-subtle);">
        <h6 class="text-uppercase" style="font-size: 0.8125rem; font-weight: 600; color: var(--gris-texto); letter-spacing: 0.05em;">
          <i class="bi bi-person-badge me-2"></i>
          Información Personal
        </h6>
      </div>

      <div class="row g-3">
        
        <!-- Nombres -->
        <div class="col-md-6">
          <label for="nombres" class="form-label-minimal">
            Nombres
            <span class="required">*</span>
          </label>
          <input id="nombres" 
                 type="text"
                 class="form-control form-control-minimal" 
                 th:field="*{nombres}" 
                 th:classappend="${#fields.hasErrors('nombres')} ? 'form-control-error' : ''"
                 placeholder="Ej: Juan Carlos">
          <small class="form-helper">Nombre(s) del cliente</small>
          <span class="error-message" th:if="${#fields.hasErrors('nombres')}" th:errors="*{nombres}">Error</span>
        </div>

        <!-- Apellidos -->
        <div class="col-md-6">
          <label for="apellidos" class="form-label-minimal">
            Apellidos
            <span class="required">*</span>
          </label>
          <input id="apellidos" 
                 type="text"
                 class="form-control form-control-minimal" 
                 th:field="*{apellidos}" 
                 th:classappend="${#fields.hasErrors('apellidos')} ? 'form-control-error' : ''"
                 placeholder="Ej: Pérez García">
          <small class="form-helper">Apellido(s) del cliente</small>
          <span class="error-message" th:if="${#fields.hasErrors('apellidos')}" th:errors="*{apellidos}">Error</span>
        </div>

      </div>

      <!-- Sección: Contacto -->
      <div class="mb-4 pb-3 mt-4" style="border-bottom: 1px solid var(--border-subtle);">
        <h6 class="text-uppercase" style="font-size: 0.8125rem; font-weight: 600; color: var(--gris-texto); letter-spacing: 0.05em;">
          <i class="bi bi-telephone me-2"></i>
          Información de Contacto
        </h6>
      </div>

      <div class="row g-3">
        
        <!-- Teléfono -->
        <div class="col-md-6">
          <label for="telefono" class="form-label-minimal">
            Teléfono
            <span class="required">*</span>
          </label>
          <div class="position-relative">
            <i class="bi bi-telephone position-absolute" style="left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gris-texto); pointer-events: none;"></i>
            <input id="telefono" 
                   type="tel"
                   class="form-control form-control-minimal" 
                   style="padding-left: 2.5rem;"
                   th:field="*{telefono}" 
                   th:classappend="${#fields.hasErrors('telefono')} ? 'form-control-error' : ''"
                   placeholder="0000-0000">
          </div>
          <small class="form-helper">Teléfono principal de contacto</small>
          <span class="error-message" th:if="${#fields.hasErrors('telefono')}" th:errors="*{telefono}">Error</span>
        </div>

        <!-- Email -->
        <div class="col-md-6">
          <label for="email" class="form-label-minimal">
            Correo Electrónico
          </label>
          <div class="position-relative">
            <i class="bi bi-envelope position-absolute" style="left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gris-texto); pointer-events: none;"></i>
            <input id="email" 
                   type="email"
                   class="form-control form-control-minimal" 
                   style="padding-left: 2.5rem;"
                   th:field="*{email}" 
                   th:classappend="${#fields.hasErrors('email')} ? 'form-control-error' : ''"
                   placeholder="cliente@ejemplo.com">
          </div>
          <small class="form-helper">Email de contacto (opcional)</small>
          <span class="error-message" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Error</span>
        </div>

      </div>

      <!-- Sección: Identificación -->
      <div class="mb-4 pb-3 mt-4" style="border-bottom: 1px solid var(--border-subtle);">
        <h6 class="text-uppercase" style="font-size: 0.8125rem; font-weight: 600; color: var(--gris-texto); letter-spacing: 0.05em;">
          <i class="bi bi-card-text me-2"></i>
          Identificación y Dirección
        </h6>
      </div>

      <div class="row g-3">
        
        <!-- DUI -->
        <div class="col-md-6">
          <label for="dui" class="form-label-minimal">
            DUI
            <span class="required">*</span>
          </label>
          <div class="position-relative">
            <i class="bi bi-card-text position-absolute" style="left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gris-texto); pointer-events: none;"></i>
            <input id="dui" 
                   type="text"
                   class="form-control form-control-minimal" 
                   style="padding-left: 2.5rem;"
                   th:field="*{dui}" 
                   th:classappend="${#fields.hasErrors('dui')} ? 'form-control-error' : ''"
                   placeholder="00000000-0"
                   maxlength="10">
          </div>
          <small class="form-helper">Documento Único de Identidad</small>
          <span class="error-message" th:if="${#fields.hasErrors('dui')}" th:errors="*{dui}">Error</span>
        </div>

        <!-- Dirección -->
        <div class="col-md-6">
          <label for="direccion" class="form-label-minimal">
            Dirección
          </label>
          <div class="position-relative">
            <i class="bi bi-geo-alt position-absolute" style="left: 1rem; top: 1rem; color: var(--gris-texto); pointer-events: none;"></i>
            <textarea id="direccion" 
                      class="form-control form-control-minimal" 
                      style="padding-left: 2.5rem; min-height: 100px;"
                      th:field="*{direccion}" 
                      th:classappend="${#fields.hasErrors('direccion')} ? 'form-control-error' : ''"
                      placeholder="Calle, colonia, ciudad..."></textarea>
          </div>
          <small class="form-helper">Dirección completa del cliente</small>
          <span class="error-message" th:if="${#fields.hasErrors('direccion')}" th:errors="*{direccion}">Error</span>
        </div>

      </div>

      <!-- Acciones -->
      <div class="form-actions">
        <button type="submit" class="btn btn-primary-form">
          <i class="bi bi-check-lg me-1"></i> 
          <span th:text="${cliente.id != null} ? 'Actualizar Cliente' : 'Guardar Cliente'">Guardar</span>
        </button>
        <a class="btn btn-secondary-form" th:href="@{/clientes}">
          <i class="bi bi-x-lg me-1"></i> Cancelar
        </a>
      </div>

    </form>
  </div>

  <!-- Nota informativa -->
  <div class="card-minimal mt-3" style="background: rgba(247, 103, 7, 0.03); border-color: rgba(247, 103, 7, 0.15);">
    <div class="card-body py-3">
      <div class="d-flex align-items-start gap-2">
        <i class="bi bi-info-circle" style="color: var(--naranja-intenso); font-size: 1.125rem; flex-shrink: 0; margin-top: 0.125rem;"></i>
        <div>
          <strong style="color: var(--naranja-intenso); font-size: 0.875rem;">Campos obligatorios</strong>
          <p class="mb-0 text-muted small mt-1">
            Los campos marcados con <span style="color: var(--naranja-intenso);">*</span> son requeridos para guardar el cliente.
          </p>
        </div>
      </div>
    </div>
  </div>

</section>
</body>
</html>